@model IEnumerable<(Sany3y.Infrastructure.Models.User User, IList<string> Roles)>

@{
    ViewData["Title"] = "User Management";
    Layout = "_AdminLayout";
}

<h1>@ViewData["Title"]</h1>

<table id="user-table" class="table table-striped table-bordered" width="100%">
    <thead>
        <tr>
            <th>National ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Role</th>
            <th>Active</th>
            <th>Created at</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.User.NationalId</td>
                <td>@item.User.UserName</td>
                <td>@item.User.Email</td>
                <td>@string.Join(", ", item.Roles)</td>
                <td>
                    @if (!item.User.IsOnline)
                    {
                        <p class="text-danger border border-danger px-2 rounded-pill">Offline</p>
                    }
                    else
                    {
                        <p class="text-success border border-success px-2 rounded-pill">Online</p>
                    }
                </td>
                <td>@item.User.CreatedAt.ToString("dd/MM/yyyy")</td>
                <td class="d-flex">
                    <button type="button" class="btn btn-outline-primary w-100 view-user-btn" data-id="@item.User.Id">
                        <i class="fa-solid fa-eye fa-sm"></i>
                    </button>
                    <button type="button" class="btn btn-outline-warning w-100 mx-2">
                        <i class="fa-solid fa-pen fa-sm"></i>
                    </button>
                    <button type="button" class="btn btn-outline-danger w-100">
                        <i class="fa-solid fa-trash fa-sm"></i>
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>

<div id="userModalContainer"></div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#user-table').DataTable({
                paging: true,
                searching: true,
                ordering: true,
                info: true,
                lengthChange: true,
                responsive: true
            });

            // عند الضغط على زر View
            $('.view-user-btn').click(function () {
                var userId = $(this).data('id');

                $.ajax({
                    url: '/Admin/ViewUser', // الأكشن اللي هننشئه دلوقتي
                    type: 'GET',
                    data: { id: userId },
                    success: function (html) {
                        $('#userModalContainer').html(html); // نعرض المودال
                        $('#viewUserModal').modal('show');   // نفتح المودال
                    },
                    error: function () {
                        alert('Error loading user details.');
                    }
                });
            });
        });
    </script>
}
